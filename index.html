<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal SOC Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #121212; color: #e0e0e0; margin: 0; padding: 20px; }
        h1, h2 { color: #76a9fa; border-bottom: 1px solid #333; padding-bottom: 10px; font-weight: 300; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; }
        .widget { background-color: #1e1e1e; padding: 20px; border-radius: 8px; border: 1px solid #333; }
        #alerts-table-container { max-height: 500px; overflow-y: auto; }
        .alerts-table { width: 100%; border-collapse: collapse; }
        .alerts-table th, .alerts-table td { padding: 12px; text-align: left; border-bottom: 1px solid #333; }
        .alerts-table th { background-color: #252525; position: sticky; top: 0; }
        .severity-High { color: #ff5555; font-weight: bold; }
        .severity-Medium { color: #ffb86c; }
        .severity-Low { color: #8be9fd; }
    </style>
</head>
<body>
    <h1>Personal Security Operations Center</h1>
    <div class="dashboard-grid">
        <div class="widget">
            <h2>Live Alerts Feed</h2>
            <div id="alerts-table-container">
                <table class="alerts-table">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Source IP</th>
                            <th>Severity</th>
                        </tr>
                    </thead>
                    <tbody id="alerts-tbody">
                        </tbody>
                </table>
            </div>
        </div>
        <div class="widget">
            <h2>Alerts by Type</h2>
            <canvas id="alertsChart"></canvas>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const alertsTbody = document.getElementById('alerts-tbody');
            let alertsChart;

            // Function to update the alerts table
            function updateAlerts() {
                fetch('/api/alerts')
                    .then(response => response.json())
                    .then(data => {
                        alertsTbody.innerHTML = ''; // Clear existing table rows
                        data.forEach(alert => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${alert.timestamp}</td>
                                <td>${alert.alert_type}</td>
                                <td>${alert.description}</td>
                                <td>${alert.source_ip || 'N/A'}</td>
                                <td class="severity-${alert.severity}">${alert.severity}</td>
                            `;
                            alertsTbody.appendChild(row);
                        });
                    });
            }

            // Function to update the chart
            function updateChart() {
                fetch('/api/alert_stats')
                    .then(response => response.json())
                    .then(stats => {
                        const ctx = document.getElementById('alertsChart').getContext('2d');
                        if (alertsChart) {
                            alertsChart.destroy(); // Destroy old chart before creating new one
                        }
                        alertsChart = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: stats.labels,
                                datasets: [{
                                    label: 'Alerts Count',
                                    data: stats.data,
                                    backgroundColor: ['#ff5555', '#ffb86c', '#8be9fd', '#50fa7b', '#bd93f9'],
                                    borderColor: '#1e1e1e',
                                    borderWidth: 3
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                        labels: { color: '#e0e0e0' }
                                    }
                                }
                            }
                        });
                    });
            }

            // Initial load and set interval to refresh data every 5 seconds
            updateAlerts();
            updateChart();
            setInterval(updateAlerts, 5000);
            setInterval(updateChart, 5000);
        });
    </script>
</body>
</html>
